<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>키우미 | 일정 추가</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        // Tailwind configuration and custom colors maintained
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-red': '#ed2024',
                        'sub-blue': '#003875',
                    }
                }
            }
        }
    </script>
    <style>
        /* 기존 디자인 스타일 유지 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            /* bg-slate-50 */
            color: #1e293b;
            /* text-slate-800 */
        }

        .app-container {
            /* 화면 꽉차게, 반응형을 위한 기본 설정 */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .section-card {
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body>

    <div class="app-container">

        <header class="flex justify-between items-center px-4 py-4 flex-shrink-0 bg-white shadow-sm">
            <h1 class="text-xl font-bold text-slate-800">일정 추가</h1>
            <button class="relative p-2 rounded-full hover:bg-slate-200 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="text-slate-600">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
            </button>
        </header>

        <main class="flex-grow px-4 py-4 overflow-y-auto pb-20">
            <div id="add-event-section" class="section-card p-4 rounded-lg shadow-md mb-8 h-full min-h-[600px]">
                <h3 class="text-lg font-bold mb-3">새로운 개인 일정</h3>
                <p class="text-slate-600 mb-4 text-sm sm:text-base">개인적인 스케줄을 달력에 등록하고 관리하세요.</p>

                <div class="bg-slate-100 p-3 rounded-lg flex flex-col h-[80%]">
                    <form id="add-event-form" method="post" action="/AddEvent" class="flex flex-col h-full p-2 space-y-4">
                        <div>
                            <label for="event-title" class="block text-sm font-medium text-slate-700">일정명</label>
                            <input type="text" id="event-title" name="title" placeholder="예: 팀 프로젝트 회의"
                                class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label for="event-date" class="block text-sm font-medium text-slate-700">날짜</label>
                                <input type="date" id="event-date" name="event_date"
                                    class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                            </div>
                            <div>
                                <label for="event-time" class="block text-sm font-medium text-slate-700">시간 (선택)</label>
                                <input type="time" id="event-time" name="event_time"
                                    class="mt-1 block w-full p-2 border border-slate-300 rounded-md shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-slate-700">배경색</label>
                            <div id="event-color-options" class="mt-2 flex space-x-3">
                                <div data-color="bg-red-200"
                                    class="event-color-option w-8 h-8 rounded-full bg-red-200 cursor-pointer ring-2 ring-offset-2 ring-sub-blue"
                                    title="빨강"></div>
                                <div data-color="bg-blue-200"
                                    class="event-color-option w-8 h-8 rounded-full bg-blue-200 cursor-pointer"
                                    title="파랑"></div>
                                <div data-color="bg-green-200"
                                    class="event-color-option w-8 h-8 rounded-full bg-green-200 cursor-pointer"
                                    title="초록"></div>
                                <div data-color="bg-yellow-200"
                                    class="event-color-option w-8 h-8 rounded-full bg-yellow-200 cursor-pointer"
                                    title="노랑"></div>
                            </div>
                            <input type="hidden" name="event_color" id="event-color" value="bg-red-200" />
                        </div>
                        <div class="mt-auto pt-4">
                            <button type="submit"
                                class="w-full bg-main-red text-white py-3 rounded-lg font-bold hover:bg-red-700 transition-colors">추가하기</button>
                            <p id="add-event-confirm" class="text-center text-green-600 font-semibold h-6 mt-2"></p>
                        </div>
                    </form>
                </div>
            </div>
        </main>

        <nav class="flex-shrink-0 sticky bottom-0 left-0 right-0 bg-white shadow-[0_-2px_5px_rgba(0,0,0,0.05)] pt-1">
            <div class="flex justify-around h-16 items-start">
                    <a href="/Main"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="text-xs mt-1">홈</span>
                </a>
                <a href="/Calendar" class="flex flex-col items-center justify-center text-main-red font-bold p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                        <line x1="16" x2="16" y1="2" y2="6"></line>
                        <line x1="8" x2="8" y1="2" y2="6"></line>
                        <line x1="3" x2="21" y1="10" y2="10"></line>
                    </svg>
                    <span class="text-xs mt-1">캘린더</span>
                </a>
                <a href="/AnnouncementGuest"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 6h13"></path>
                        <path d="M8 12h13"></path>
                        <path d="M8 18h13"></path>
                        <path d="M3 6h.01"></path>
                        <path d="M3 12h.01"></path>
                        <path d="M3 18h.01"></path>
                    </svg>
                    <span class="text-xs mt-1">공지사항</span>
                </a>
                <a href="/Timetable"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="7" height="9" x="3" y="3" rx="1"></rect>
                        <rect width="7" height="5" x="14" y="3" rx="1"></rect>
                        <rect width="7" height="9" x="14" y="12" rx="1"></rect>
                        <rect width="7" height="5" x="3" y="16" rx="1"></rect>
                    </svg>
                    <span class="text-xs mt-1">시간표</span>
                </a>
                <a href="/MyPage"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span class="text-xs mt-1">마이</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            function showConfirmation(elementId, message) {
                const el = document.getElementById(elementId);
                if (el) {
                    el.textContent = message;
                    setTimeout(() => {
                        el.textContent = '';
                    }, 3000);
                }
            }

            // --- Add Item Form Logic ---
            const addEventForm = document.getElementById('add-event-form');
            const eventColorOptions = document.getElementById('event-color-options');

            const eventColorHidden = document.getElementById('event-color');
            if (eventColorOptions) {
                eventColorOptions.addEventListener('click', (e) => {
                    if (e.target.classList.contains('event-color-option')) {
                        // Remove selection from all options
                        eventColorOptions.querySelectorAll('.event-color-option').forEach(opt => {
                            opt.classList.remove('ring-2', 'ring-offset-2', 'ring-sub-blue');
                        });
                        // Add selection to the clicked option
                        e.target.classList.add('ring-2', 'ring-offset-2', 'ring-sub-blue');
                        if (eventColorHidden) eventColorHidden.value = e.target.dataset.color || 'bg-red-200';
                    }
                });
            }

            if (addEventForm) {
                addEventForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const selectedColorEl = eventColorOptions.querySelector('.ring-sub-blue');
                    const titleInput = document.getElementById('event-title');
                    const dateInput = document.getElementById('event-date');
                    const timeInput = document.getElementById('event-time');

                    if (!titleInput.value || !dateInput.value || !selectedColorEl) {
                        alert('제목, 날짜, 색상은 필수입니다!');
                        return;
                    }

                    // x-www-form-urlencoded로 전송
                    const params = new URLSearchParams();
                    params.set('title', titleInput.value);
                    params.set('event_date', dateInput.value);
                    params.set('event_time', timeInput.value || ''); // 빈 문자열도 허용
                    params.set('event_color', selectedColorEl.dataset.color || 'bg-red-200');

                    try {
                        const resp = await fetch('/AddEvent', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'Accept': 'application/json' },
                            body: params.toString()
                        });
                        const data = await resp.json();
                        if (data && data.ok) {
                            alert('성공적으로 추가되었습니다!');
                            // 입력 초기화
                            addEventForm.reset();
                            eventColorOptions.querySelectorAll('.event-color-option').forEach(opt => {
                                opt.classList.remove('ring-2', 'ring-offset-2', 'ring-sub-blue');
                            });
                            eventColorOptions.children[0].classList.add('ring-2', 'ring-offset-2', 'ring-sub-blue');
                            if (eventColorHidden) eventColorHidden.value = 'bg-red-200';
                        } else {
                            alert(data && data.message ? data.message : '추가 실패');
                        }
                    } catch (e) {
                        console.error(e);
                        alert('서버 오류');
                    }
                });
            }

            // --- Initial Color Selection ---
            // 페이지 로드 시 첫 번째 색상을 기본으로 선택
            if (eventColorOptions && eventColorOptions.children.length > 0) {
                eventColorOptions.children[0].classList.add('ring-2', 'ring-offset-2', 'ring-sub-blue');
            }
        });
    </script>
</body>

</html>