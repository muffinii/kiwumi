<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>키우미 | 홈</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
    <script>
        // Tailwind configuration and custom colors maintained
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'main-red': '#ed2024',
                        'sub-blue': '#003875',
                    }
                }
            }
        }
    </script>
    <style>
        /* 기존 디자인 스타일 유지 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background-color: #f8fafc;
            /* bg-slate-50 */
            color: #1e293b;
            /* text-slate-800 */
        }

        .app-container {
            /* 화면 꽉차게, 반응형을 위한 기본 설정 */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .section-card {
            background-color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
        }
    </style>
</head>

<body>

    <div class="app-container">

        <main class="flex-grow px-4 py-6 overflow-y-auto pb-20">

            <header class="flex justify-between items-center mb-6">
                <div>
                    <h1 class="text-2xl font-bold text-slate-800">{{ userName }}님,</h1>
                    <p class="text-slate-500">안녕하세요!</p>
                </div>
                <a href="/Notifications" id="notificationBell"
                    class="relative p-2 rounded-full hover:bg-slate-200 transition-colors inline-block">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-slate-600">
                        <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                        <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                    </svg>
                    <span id="notificationBadge" class="absolute top-2 right-2 block w-2 h-2 bg-main-red rounded-full hidden"></span>
                </a>
            </header>

            <section class="mb-8">
                <h2 class="text-lg font-bold mb-3 text-slate-700">오늘의 일정</h2>
                <div class="section-card space-y-3">
                    {% if todaySchedule and todaySchedule.length > 0 %}
                        {% for item in todaySchedule %}
                        <div class="flex items-center">
                            <div class="w-1.5 h-10 {{ item.color }} mr-4 rounded-full"></div>
                            <div class="flex-grow">
                                <p class="font-bold text-slate-800">{{ item.title }}</p>
                                <p class="text-sm text-slate-500">
                                    {% if item.time %}{{ item.time }}{% endif %}
                                    {% if item.location %} | {{ item.location }}{% endif %}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-center text-slate-500 py-4">오늘 예정된 일정이 없습니다.</p>
                    {% endif %}
                    <div class="text-center pt-2">
                        <a href="/Calendar" class="text-sm text-sub-blue font-semibold">캘린더에서 전체 일정 보기
                            &rarr;</a>
                    </div>
                </div>
            </section>

            {% if user_role == 'student' %}
                <section class="mb-8">
                    <h2 class="text-lg font-bold mb-3 text-slate-700">빠른 메뉴</h2>
                    <div>
                        <a href="/Timetable#grade-summary-section" class="block group">
                            <div class="section-card block">
                                <p class="text-sm font-semibold text-slate-500 mb-2">학점 현황</p>
                                {% if gpaInfo %}
                                <p class="font-bold text-2xl text-sub-blue">{{ gpaInfo.gpa }} <span
                                        class="text-base text-slate-400 font-medium">/ 4.5</span></p>
                                <p class="text-xs text-slate-400 mt-1">총 {{ gpaInfo.totalCredits }}학점 이수</p>
                                {% else %}
                                <p class="font-bold text-2xl text-sub-blue">0.00 <span
                                        class="text-base text-slate-400 font-medium">/ 4.5</span></p>
                                <p class="text-xs text-slate-400 mt-1">총 0학점 이수</p>
                                {% endif %}
                            </div>
                        </a>
                    </div>
                </section>
            {% endif %}
            
            <section>
                <h2 class="text-lg font-bold mb-3 text-slate-700">최근 공지사항</h2>
                <div class="section-card space-y-2">
                    {% if announcements and announcements.length > 0 %}
                        {% for a in announcements %}
                        <a href="/ViewAnnouncement/{{ a.pkid }}" class="block p-2 rounded-md hover:bg-slate-50">
                            <p class="font-bold text-sm truncate">
                                {% set catClass = 'text-slate-600' %}
                                {% if (a.category == '학사') %}{% set catClass = 'text-main-red' %}{% elif (a.category == '공모') %}{% set catClass = 'text-sub-blue' %}{% elif (a.category == '채용') %}{% set catClass = 'text-purple-600' %}{% endif %}
                                <span class="font-extrabold {{ catClass }}">[{{ a.category or '일반' }}]</span>
                                {{ a.title }}
                            </p>
                            <p class="text-xs text-slate-400 text-right">{{ a.created_at }}</p>
                        </a>
                        {% endfor %}
                    {% else %}
                        <p class="text-center text-slate-500 p-4 text-sm">공지사항이 없습니다.</p>
                    {% endif %}
                </div>
            </section>
        </main>

        <nav class="flex-shrink-0 sticky bottom-0 left-0 right-0 bg-white shadow-[0_-2px_5px_rgba(0,0,0,0.05)] pt-1">
            <div class="flex justify-around h-16 items-start">
                <a href="#" class="flex flex-col items-center justify-center text-main-red font-bold p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                        <polyline points="9 22 9 12 15 12 15 22"></polyline>
                    </svg>
                    <span class="text-xs mt-1">홈</span>
                </a>
                <a a href="/Calendar"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect width="18" height="18" x="3" y="4" rx="2" ry="2"></rect>
                        <line x1="16" x2="16" y1="2" y2="6"></line>
                        <line x1="8" x2="8" y1="2" y2="6"></line>
                        <line x1="3" x2="21" y1="10" y2="10"></line>
                    </svg>
                    <span class="text-xs mt-1">캘린더</span>
                </a>
                <a href="/Announcement"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 6h13"></path>
                        <path d="M8 12h13"></path>
                        <path d="M8 18h13"></path>
                        <path d="M3 6h.01"></path>
                        <path d="M3 12h.01"></path>
                        <path d="M3 18h.01"></path>
                    </svg>
                    <span class="text-xs mt-1">공지사항</span>
                </a>
                {% if user_role == 'student' %}
                    <a href="/Timetable"
                        class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect width="7" height="9" x="3" y="3" rx="1"></rect>
                            <rect width="7" height="5" x="14" y="3" rx="1"></rect>
                            <rect width="7" height="9" x="14" y="12" rx="1"></rect>
                            <rect width="7" height="5" x="3" y="16" rx="1"></rect>
                        </svg>
                        <span class="text-xs mt-1">시간표</span>
                    </a>
                {% endif %}
                <a href="/MyPage"
                    class="flex flex-col items-center justify-center text-slate-500 hover:text-sub-blue p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    <span class="text-xs mt-1">마이</span>
                </a>
            </div>
        </nav>
    </div>

    <script>
        // 읽지 않은 알림 개수 확인
        async function checkUnreadNotifications() {
            try {
                const response = await fetch('/api/notifications/unread-count');
                const data = await response.json();
                
                if (data.ok && data.count > 0) {
                    document.getElementById('notificationBadge').classList.remove('hidden');
                } else {
                    document.getElementById('notificationBadge').classList.add('hidden');
                }
            } catch (error) {
                console.error('알림 개수 조회 오류:', error);
            }
        }

        // 페이지 로드 시 알림 개수 확인
        document.addEventListener('DOMContentLoaded', () => {
            checkUnreadNotifications();
            // 15초마다 알림 개수 자동 확인
            setInterval(checkUnreadNotifications, 15000);
        });
    </script>
</body>

</html>
